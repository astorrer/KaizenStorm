%h1= @page_title = 'View / Change Billing Information'
- if @subscription.state == 'trial'
  - if @subscription.next_renewal_at > Time.now
    %p
      Thank you for trying #{Saas::Config.app_name}!  Your trial account will expire in #{pluralize(@subscription.trial_days, 'day', 'days')}, at which time you will no longer have access to your account.  To maintain access to your account, enter your credit card information below.  Your first charge will happen on #{@subscription.next_renewal_at.to_s(:long_day)}.
  - else
    Thank you for trying #{Saas::Config.app_name}!  Your trial account has expired.  To regain access to your account, enter your credit card information below.  Your first charge will happen immediately, and you will be billed monthly thereafter.
%fieldset
  %label Plan:
  = @subscription.subscription_plan.name
  (
  %a{:href => "/account/plan"}> Change plan
  )
  - if @subscription.state == 'trial'
    %label Trial expiration date:
    = @subscription.next_renewal_at.to_s(:long_day)
  - else
    - if @subscription.amount > 0
      %label Next charge date:
      = @subscription.next_renewal_at.to_s(:long_day)
      %br/
      %label Next charge amount:
      = number_to_currency @subscription.amount
      %br/
      %label Current payment method:
      = "#{@subscription.card_number} / #{@subscription.card_expiration}"
- if @subscription.amount > 0
  = render 'credit_card_form'
- content_for :head do
  %script{:src => "https://js.stripe.com/v1/", :type => "text/javascript"}
  = javascript_include_tag 'stripe_form'
  :javascript
    // this identifies your website in the createToken call in stripe_form.js
    Stripe.setPublishableKey('#{Saas::Config.credentials['stripe_publishable_key']}');
- end if Saas::Config.gateway == 'stripe' and Saas::Config.credentials['stripe_publishable_key']
